<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§Ÿè»Šç°½èªå–®ç”Ÿæˆå™¨</title>
    <!-- Tailwind CSS for App UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@600;700&display=swap"
        rel="stylesheet">
    <!-- html2canvas -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        /* Global Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* Document Capture Area */
        #capture-area {
            width: 950px;
            /* Slightly wider */
            height: 700px;
            /* Increased height to contain all borders comfortably */
            padding: 30px 60px 30px 30px;
            /* More padding */
            background: white;
            color: black;
            box-sizing: border-box;
            /* Create the double border effect of the outer page */
            border: 3px solid #3b82f6;
            margin: 20px;
            position: relative;
            /* For absolute positioning of side text */
            overflow: hidden;
            /* Ensure nothing visually spills out */
        }

        .doc-container {
            width: 100%;
            height: 100%;
            position: relative;
            padding: 10px 10px;
        }

        /* Side Text Container (Stubs) */
        .side-text-container {
            position: absolute;
            right: -55px;
            /* Push completely outside the table */
            top: 40px;
            /* Adjusted up slightly as user requested */
            width: 30px;
            display: flex;
            flex-direction: column;
            /* Standard vertical stacking */
            gap: 150px;
            pointer-events: none;
            /* Don't interfere with clicks */
        }

        .side-text-container span {
            font-family: 'Noto Serif TC', serif;
            font-size: 14px;
            letter-spacing: 0.2em;
            /* Reduced sightly for tighter look */
            writing-mode: vertical-rl;
            text-orientation: upright;
        }

        /* Title Styling */
        .doc-title {
            font-size: 32px;
            font-family: 'Noto Serif TC', serif;
            margin-bottom: 2px;
        }

        .title-underline-double {
            width: 200px;
            height: 4px;
            border-top: 1px solid black;
            border-bottom: 1px solid black;
        }

        /* Table Styling */
        .doc-table {
            border: 2px solid black;
            width: 100%;
            margin-top: 5px;
        }

        .doc-table td {
            border-bottom: 1px solid black;
        }

        .doc-table tr:last-child td {
            border-bottom: none;
        }

        /* Vertical Text Helper */
        .vertical-text-center {
            /* writing-mode indicates vertical text, but for short 2-char words like æ™‚é–“, 
            flex-column is often safer across browsers/html2canvas if spacing is tricky.
            Keeping writing-mode but adjusting line-height/spacing. */
            writing-mode: vertical-rl;
            text-orientation: upright;
            margin: 0 auto;
            letter-spacing: 0.3em;
            display: inline-block;
            /* Revert to inline-block/block from flex */
        }

        /* Special alignment for "Time" (æ™‚é–“) */
        .vertical-text-center.time-header {
            letter-spacing: 0.4em;
        }

        .writing-vertical {
            writing-mode: vertical-rl;
            text-orientation: upright;
        }

        /* Checkbox imitation - REMOVED (Switched to Unicode chars â˜/â˜‘) */
    </style>
</head>

<body class="bg-gray-100 min-h-screen font-[&#39;Noto_Sans_TC&#39;] text-gray-800">

    <div class="container mx-auto px-4 py-8 flex flex-col lg:flex-row gap-8">

        <!-- Input Panel -->
        <div class="w-full lg:w-1/3 bg-white rounded-2xl shadow-xl p-6 overflow-y-auto max-h-[90vh] custom-scrollbar">
            <h2 class="text-2xl font-bold mb-6 text-gray-800 flex items-center">
                <span>ğŸ“ å¡«å¯«è³‡æ–™</span>
            </h2>

            <form id="rentalForm" class="space-y-5">
                <!-- Company/Client -->
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-600">å…¬å¸ / å®¢æˆ¶åç¨±</label>
                    <input type="text" id="clientName" value="ç©©å¾—"
                        class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all outline-none"
                        placeholder="è¼¸å…¥åç¨±">
                </div>

                <!-- Date -->
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-600">å¹´</label>
                        <input type="number" id="year" value="114"
                            class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-600">æœˆ</label>
                        <input type="number" id="month" value="12"
                            class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-600">æ—¥</label>
                        <input type="number" id="day" value="9"
                            class="w-full px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>

                <!-- Time -->
                <div class="border-t pt-4">
                    <label class="block text-sm font-medium text-gray-600 mb-2">æ™‚é–“ (ç”±)</label>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="startHour" value="05" placeholder="æ™‚"
                            class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        <input type="number" id="startMin" value="20" placeholder="åˆ†"
                            class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <label class="block text-sm font-medium text-gray-600 my-2">è‡³</label>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="endHour" placeholder="æ™‚"
                            class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        <input type="number" id="endMin" placeholder="åˆ†"
                            class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <label class="block text-sm font-medium text-gray-600 my-2">å…±è¨ˆ</label>
                    <div class="grid grid-cols-2 gap-2">
                        <input type="number" id="totalHour" placeholder="æ™‚"
                            class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                        <input type="number" id="totalMin" placeholder="åˆ†"
                            class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                </div>

                <!-- Itinerary -->
                <div class="space-y-2 border-t pt-4">
                    <label class="block text-sm font-medium text-gray-600">è¡Œç¨‹å…§å®¹</label>
                    <textarea id="itinerary" rows="4"
                        class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none custom-scrollbar"
                        placeholder="è¼¸å…¥è¡Œç¨‹ç´°ç¯€...">ç©©å¾— 05:20(Justin å¾å…ˆç”Ÿ 0930-378-880)(1ä½+1è¡Œæ)
æ–°åŒ—å¸‚æ±æ­¢å€æ±éŒ è·¯16-1å··18è™Ÿâ†’é€æ¡ƒæ©Ÿä¸€èˆª(CI-160/07:50)</textarea>
                </div>

                <!-- Car Type -->
                <div class="space-y-2 border-t pt-4">
                    <label class="block text-sm font-medium text-gray-600 mb-2">è»Šè¼›ç¨®é¡</label>
                    <div class="flex gap-4">
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="checkImport"
                                class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span>é€²å£è»Š</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="checkDomestic"
                                class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span>åœ‹ç”¢è»Š</span>
                        </label>
                        <label class="flex items-center gap-2 cursor-pointer">
                            <input type="checkbox" id="checkSeat"
                                class="w-4 h-4 text-blue-600 rounded focus:ring-blue-500">
                            <span>7-9äººåº§</span>
                        </label>
                    </div>
                </div>

                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-600">è»Šè™Ÿ</label>
                    <input type="text" id="carNumber" value="RFR-6171"
                        class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-600">é§•é§›</label>
                    <input type="text" id="driver" value="è˜‡å£«ç¨‹"
                        class="w-full px-4 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                </div>

                <!-- Payment -->
                <div class="space-y-2 border-t pt-4">
                    <div class="grid grid-cols-2 gap-2 items-center">
                        <span class="text-sm font-medium">åŸºæœ¬å°æ™‚ $</span>
                        <input type="text" id="baseCost"
                            class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div class="grid grid-cols-2 gap-2 items-center">
                        <span class="text-sm font-medium">è¶…æ™‚å°æ™‚ $</span>
                        <input type="text" id="overtimeCost"
                            class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div class="grid grid-cols-2 gap-2 items-center">
                        <span class="text-sm font-medium font-bold">ç¸½è¨ˆ NT$</span>
                        <input type="text" id="totalCost"
                            class="px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none font-bold">
                    </div>
                </div>


                <div class="pt-6">
                    <button type="button" onclick="generateImage()"
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-xl shadow-lg transform transition hover:-translate-y-1 hover:shadow-xl flex items-center justify-center gap-2">
                        <span>â¬‡ï¸ ä¸‹è¼‰åœ–ç‰‡</span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Preview Panel -->
        <div
            class="w-full lg:w-2/3 flex flex-col items-center justify-start bg-gray-200/50 rounded-2xl p-4 lg:p-8 overflow-auto">
            <div class="mb-4 text-gray-500 font-medium text-sm">é è¦½ (å°‡ç”Ÿæˆæ­¤ç•«é¢)</div>

            <!-- Exact Document Template -->
            <div id="capture-area" class="bg-white shadow-2xl relative">
                <!-- Outer Border Container -->
                <div class="doc-container">

                    <!-- Title -->
                    <h1 class="text-center font-bold tracking-widest doc-title">ç§Ÿè»Šç°½èªå–®</h1>
                    <div class="title-underline-double mx-auto"></div>

                    <!-- Header Values -->
                    <div class="flex justify-between items-end mt-4 mb-1 px-1">
                        <div class="flex items-end text-xl">
                            <span class="font-bold font-serif tracking-widest mr-2">å…¬å¸/å®¢æˆ¶åç¨±</span>
                            <span id="preview-clientName"
                                class="border-b-2 border-black min-w-[200px] text-center px-2 pb-1 font-medium"></span>
                        </div>
                        <div class="flex items-end text-xl font-bold font-serif tracking-widest">
                            <span id="preview-year" class="px-2"></span>å¹´
                            <span id="preview-month" class="px-2"></span>æœˆ
                            <span id="preview-day" class="px-2"></span>æ—¥
                        </div>
                    </div>

                    <!-- Main Table -->
                    <table class="w-full border-collapse doc-table">
                        <!-- Row 1: Time Header -->
                        <tr class="h-14">
                            <td class="w-14 text-center font-serif text-xl border-r border-black relative">
                                <span class="vertical-text-center time-header">æ™‚é–“</span>
                            </td>
                            <td colspan="4" class="border-r border-black p-0">
                                <div class="flex justify-between items-center h-full px-4 text-xl font-serif">
                                    <div class="flex items-center"><span id="preview-startHour"
                                            class="mx-2 font-sans font-normal"></span> æ™‚</div>
                                    <div class="flex items-center"><span id="preview-startMin"
                                            class="mx-2 font-sans font-normal"></span> åˆ†è‡³</div>
                                    <div class="flex items-center"><span id="preview-endHour"
                                            class="mx-2 font-sans font-normal"></span> æ™‚</div>
                                    <div class="flex items-center"><span id="preview-endMin"
                                            class="mx-2 font-sans font-normal"></span> åˆ†</div>
                                </div>
                            </td>
                            <td class="w-12 text-center font-serif text-xl border-r border-black">å…±è¨ˆ</td>
                            <td class="border-black">
                                <div class="flex justify-around items-center text-xl font-serif">
                                    <div><span id="preview-totalHour" class="mx-1 font-sans font-normal"></span> æ™‚</div>
                                    <div><span id="preview-totalMin" class="mx-1 font-sans font-normal"></span> åˆ†</div>
                                </div>
                            </td>
                        </tr>

                        <!-- Row 2: Itinerary -->
                        <tr class="h-48">
                            <td class="text-center font-serif text-xl border-r border-black relative">
                                <span class="vertical-text-center">è¡Œç¨‹</span>
                            </td>
                            <td colspan="6" class="align-top p-3 text-lg font-bold leading-relaxed whitespace-pre-wrap"
                                id="preview-itinerary">
                            </td>
                        </tr>

                        <!-- Row 3: Car Type / Driver -->
                        <!-- Row 3: Car Type / Driver -->
                        <tr class="h-24">
                            <!-- Car Type Label -->
                            <td class="h-24 text-center font-serif text-xl border-r border-black relative w-14 p-0">
                                <div class="vertical-text-center h-full flex flex-col justify-center items-center"
                                    style="letter-spacing: 0.1em; line-height: 1.2;">
                                    è»Šè¼›<br>ç¨®é¡</div>
                            </td>
                            <!-- Car Type Checkboxes -->
                            <td class="h-24 border-r border-black w-36 p-0 align-middle">
                                <!-- Added pb-3 to nudge content up from center -->
                                <div
                                    class="h-full flex flex-col justify-center pb-3 pl-3 text-lg font-bold font-serif space-y-1">
                                    <div class="flex items-center">é€²å£è»Š<span class="ml-1 text-lg leading-none"
                                            id="preview-checkImport">â˜</span></div>
                                    <div class="flex items-center">åœ‹ç”¢è»Š<span class="ml-1 text-lg leading-none"
                                            id="preview-checkDomestic">â˜</span></div>
                                    <div class="flex items-center">7-9äººåº§<span class="ml-1 text-lg leading-none"
                                            id="preview-checkSeat">â˜</span></div>
                                </div>
                            </td>
                            <!-- Label: Car No / Driver -->
                            <td class="h-24 w-10 border-r border-black p-0">
                                <div class="flex flex-col h-full font-serif text-sm">
                                    <div class="flex-1 w-full border-b border-black flex items-center justify-center">
                                        <div class="text-center leading-tight">è»Š<br>è™Ÿ</div>
                                    </div>
                                    <div class="flex-1 w-full flex items-center justify-center">
                                        <div class="text-center leading-tight">é§•<br>é§›</div>
                                    </div>
                                </div>
                            </td>
                            <!-- Value: Car No / Driver -->
                            <td class="h-24 w-48 border-r border-black p-0">
                                <div class="flex flex-col h-full">
                                    <div class="flex-1 w-full border-b border-black flex items-center pl-4 text-xl font-bold"
                                        id="preview-carNumber"></div>
                                    <div class="flex-1 w-full flex items-center pl-4 text-xl font-bold"
                                        id="preview-driver">
                                    </div>
                                </div>
                            </td>
                            <!-- Label: Basic / Overtime -->
                            <td class="h-24 w-10 border-r border-black p-0">
                                <div class="flex flex-col h-full font-serif text-lg">
                                    <!-- Added pb-1 to nudge label up -->
                                    <div
                                        class="flex-1 w-full border-b border-black flex items-center justify-center pb-1">
                                        <div class="text-center leading-tight">åŸº<br>æœ¬</div>
                                    </div>
                                    <!-- Added pb-1 to nudge label up -->
                                    <div class="flex-1 w-full flex items-center justify-center pb-1">
                                        <div class="text-center leading-tight">è¶…<br>æ™‚</div>
                                    </div>
                                </div>
                            </td>
                            <!-- Value: Basic / Overtime -->
                            <td colspan="2" class="h-24 p-0">
                                <div class="flex flex-col h-full">
                                    <div
                                        class="flex-1 w-full border-b border-black flex items-center justify-end pr-4 text-xl font-serif">
                                        å° æ™‚ $ <span id="preview-baseCost"
                                            class="ml-2 w-16 text-center font-sans font-bold"></span>
                                    </div>
                                    <div class="flex-1 w-full flex items-center justify-end pr-4 text-xl font-serif">
                                        å° æ™‚ $ <span id="preview-overtimeCost"
                                            class="ml-2 w-16 text-center font-sans font-bold"></span>
                                    </div>
                                </div>
                            </td>
                        </tr>

                        <!-- Row 4: Signature / Totals -->
                        <tr class="h-32">
                            <td class="h-32 text-center font-serif text-xl border-r border-black relative w-14 p-0">
                                <div class="vertical-text-center h-full flex flex-col justify-center items-center"
                                    style="letter-spacing: 0.1em; line-height: 1.2;">
                                    é¡§å®¢<br>ç°½å</div>
                            </td>
                            <td colspan="3" class="h-32 align-top p-2 border-r border-black relative">
                                <span
                                    class="italic font-serif text-xl text-gray-700 absolute top-2 left-2">SIGNATURE</span>
                            </td>
                            <!-- Label: Rent / Remarks -->
                            <td class="h-32 w-8 border-r border-black p-0">
                                <div class="flex flex-col h-full font-serif text-lg">
                                    <div class="flex-1 w-full border-b border-black flex items-center justify-center">
                                        <div class="text-center leading-tight">ç§Ÿ<br>é‡‘</div>
                                    </div>
                                    <div class="flex-1 w-full flex items-center justify-center">
                                        <div class="text-center leading-tight">å‚™<br>è¨»</div>
                                    </div>
                                </div>
                            </td>
                            <!-- Value: Total / Remarks -->
                            <td colspan="2" class="h-32 p-0">
                                <div class="flex flex-col h-full">
                                    <div
                                        class="flex-1 w-full border-b border-black flex items-center pl-2 text-xl font-serif">
                                        <span class="text-lg font-bold leading-none mr-2">ç¸½è¨ˆ</span>
                                        <span class="text-2xl font-bold italic mr-1">NT$</span>
                                        <span id="preview-totalCost" class="text-2xl font-bold italic"></span>
                                    </div>
                                    <div class="flex-1 w-full flex items-center pl-2">
                                        <!-- Remarks -->
                                    </div>
                                </div>
                            </td>
                        </tr>

                    </table>

                    <!-- Side Text (Absolute positioned relative to doc-container) -->
                    <div class="side-text-container">
                        <span>å­˜æ ¹è¯ ï¸µç™½ï¸¶</span>
                        <span>å®¢æˆ¶è¯ ï¸µç´…ï¸¶</span>
                    </div>

                </div>
            </div>

        </div>
    </div>

    <script>
        // Link input IDs to Preview IDs
        const bindings = [
            'clientName', 'year', 'month', 'day',
            'startHour', 'startMin', 'endHour', 'endMin', 'totalHour', 'totalMin',
            'carNumber', 'driver',
            'baseCost', 'overtimeCost', 'totalCost'
        ];

        // Special handling for content that needs processing
        const specialBindings = {
            'itinerary': (val) => val, // Textarea preserves newlines via CSS
        };

        const checkboxes = ['checkImport', 'checkDomestic', 'checkSeat'];

        function updatePreview() {
            // Standard Text Inputs
            bindings.forEach(id => {
                const input = document.getElementById(id);
                const preview = document.getElementById(`preview-${id}`);
                if (input && preview) {
                    preview.textContent = input.value;
                }
            });

            // Textarea
            const itineraryInput = document.getElementById('itinerary');
            const itineraryPreview = document.getElementById('preview-itinerary');
            if (itineraryInput && itineraryPreview) {
                itineraryPreview.textContent = itineraryInput.value;
            }

            // Checkboxes
            checkboxes.forEach(id => {
                const input = document.getElementById(id);
                const preview = document.getElementById(`preview-${id}`);
                if (input && preview) {
                    // Use unicode characters instead of CSS styling for reliable rendering
                    preview.textContent = input.checked ? 'â˜‘' : 'â˜';
                    // Ensure font size and alignment matches text
                    preview.style.fontSize = '1.2em';
                    // Reset excessive scaling if previously applied, or keep generic styling
                }
            });
        }

        // Attach Event Listeners
        document.addEventListener('DOMContentLoaded', () => {
            const inputs = document.querySelectorAll('input, textarea');
            inputs.forEach(input => {
                input.addEventListener('input', updatePreview);
                input.addEventListener('change', updatePreview);
            });

            // Initial update
            updatePreview();
        });

        function generateImage() {
            const btn = document.querySelector('button[onclick="generateImage()"]');
            const originalText = btn.innerHTML;

            // 1. Visual Feedback
            btn.innerHTML = '<span>â³ è™•ç†ä¸­...</span>';
            btn.disabled = true;

            // 2. Library Check
            if (typeof html2canvas === 'undefined') {
                alert('éŒ¯èª¤ï¼šç„¡æ³•è¼‰å…¥åœ–ç‰‡ç”Ÿæˆå·¥å…· (html2canvas)ã€‚\nè«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£ç·šï¼Œæˆ–å˜—è©¦ä½¿ç”¨æˆªåœ–åŠŸèƒ½ã€‚');
                btn.innerHTML = originalText;
                btn.disabled = false;
                return;
            }

            const element = document.getElementById('capture-area');

            // 3. Execution
            html2canvas(element, {
                scale: 2, // High resolution
                backgroundColor: null,
                useCORS: true,
                logging: true, // Enable logs for debugging
            }).then(canvas => {
                // Create download link
                const link = document.createElement('a');
                link.download = `ç§Ÿè»Šç°½èªå–®_${document.getElementById('clientName').value || 'æœªå‘½å'}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                // Reset button
                btn.innerHTML = originalText;
                btn.disabled = false;
            }).catch(err => {
                console.error('Image generation failed:', err);
                alert('åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼Œå¯èƒ½çš„å®‰å…¨é™åˆ¶ã€‚\nå»ºè­°ç›´æ¥ä½¿ç”¨é›»è…¦çš„æˆªåœ–å·¥å…· (Win+Shift+S)ã€‚\néŒ¯èª¤è¨Šæ¯: ' + err.message);

                // Reset button
                btn.innerHTML = originalText;
                btn.disabled = false;
            });
        }
    </script>
</body>

</html>